---
# tasks file for install_client

# # ------------------------------------------------------------------------------
# # SETUP USERS
# - name: setup users
#   include_tasks: setup_users.yml

# ------------------------------------------------------------------------------
# INSTALL SPECIFIC SERVICES - BY APT
- name: install apt services
  include_tasks: install_apt.yml

# ------------------------------------------------------------------------------
# INSTALL SPECIFIC SERVICES - BY DPKG
- name: install dpkg services
  include_tasks: install_dpkg.yml

# ------------------------------------------------------------------------------
# INSTALL SPECIFIC SERVICES - BY DISTRIBUTION KEY
- name: install distribution services
  include_tasks: install_extra_distribution_key.yml
  loop: "{{ install_client_distribution_key | flatten(levels=1) }}"
  loop_control:
    loop_var: outer_item
  when: install_client_distribution_key is defined and (outer_item.install is defined and outer_item.install | bool)

# ------------------------------------------------------------------------------
# INSTALL SPECIFIC SERVICES - BY SNAP
- name: install snap services
  include_tasks: install_snap.yml

# ------------------------------------------------------------------------------
# INSTALL SPECIFIC SERVICES - BY FLATPAK
- name: install flatpak services (per user)
  include_tasks: install_flatpak.yml
  loop: "{{ clients | flatten(levels=1) }}"
  loop_control:
    loop_var: outer_item
  when: >
    clients is defined and install_client_flatpak is defined
    and (outer_item.setup is not defined or outer_item.setup | bool)

# ------------------------------------------------------------------------------
# JAVA PACKAGES
- name: install java packages
  include_tasks: install_java.yml
  when: install_client_config.java is defined and install_client_config.java | bool

# ------------------------------------------------------------------------------
# INSTALL EXTRAS PER USER
- name: install fonts (per user)
  include_tasks: install_per_user_fonts.yml
  loop: "{{ clients | flatten(levels=1) }}"
  loop_control:
    loop_var: outer_item
  when: >
    install_client_config.fonts is defined and install_client_config.fonts | bool
    and (outer_item.setup is not defined or outer_item.setup | bool)

- name: install code extras (per user)
  include_tasks: install_per_user_code_extra.yml
  loop: "{{ clients | flatten(levels=1) }}"
  loop_control:
    loop_var: outer_item
  when: >
    install_client_config.vs_code_ext is defined and install_client_config.vs_code_ext | bool
    and (outer_item.setup is not defined or outer_item.setup | bool)

# ------------------------------------------------------------------------------
# GNOME SETUP (FAVORITES)
- name: setup gnome (per user)
  include_tasks: setup_gnome.yml
  loop: "{{ clients | flatten(levels=1) }}"
  loop_control:
    loop_var: outer_item
  when: >
    install_client_config.gnome_gui_setup is defined and install_client_config.gnome_gui_setup | bool
    and (outer_item.setup is not defined or outer_item.setup | bool)

# ------------------------------------------------------------------------------
# OTHER SETUPS
- name: setup other settings
  include_tasks: setup_other.yml
